<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="A fit to the table is obtained from the log-linear fit that matches the
  numbers in the margins specified by the margin parameters."><title>Synthesis of a group of categorical variables by iterative
  proportional fitting — syn.ipf • synthpop</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Synthesis of a group of categorical variables by iterative
  proportional fitting — syn.ipf"><meta property="og:description" content="A fit to the table is obtained from the log-linear fit that matches the
  numbers in the margins specified by the margin parameters."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">synthpop</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.8-2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Synthesis of a group of categorical variables by iterative
  proportional fitting</h1>
      
      <div class="d-none name"><code>syn.ipf.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A fit to the table is obtained from the log-linear fit that matches the
  numbers in the margins specified by the margin parameters.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">syn.ipf</span><span class="op">(</span><span class="va">x</span>, <span class="va">k</span>, proper <span class="op">=</span> <span class="cn">FALSE</span>, priorn <span class="op">=</span> <span class="fl">1</span>, structzero <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        gmargins <span class="op">=</span> <span class="st">"twoway"</span>, othmargins <span class="op">=</span> <span class="cn">NULL</span>, tol <span class="op">=</span> <span class="fl">1e-3</span>,</span>
<span>        max.its <span class="op">=</span> <span class="fl">5000</span>, maxtable <span class="op">=</span> <span class="fl">1e8</span>, print.its <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        epsilon <span class="op">=</span> <span class="fl">0</span>, rand <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p>a data frame of the set of original data to be synthesised.</p></dd>

  <dt>k</dt>
<dd><p>a number of rows in each synthetic data set - defaults to <code>n</code>.</p></dd>

  <dt>proper</dt>
<dd><p>if <code>proper = TRUE</code> <code>x</code> is replaced with a bootstrap
    sample before synthesis, thus effectively sampling from the posterior
    distribution of the model, given the data.</p></dd>

  <dt>priorn</dt>
<dd><p>the sum of the parameters of the Dirichlet prior which can be
    thought of as a pseudo-count giving the number of observations that inform
    prior knowledge about the parameters.</p></dd>

  <dt>structzero</dt>
<dd><p>a named list of lists that defines which cells in the table
    are structural zeros and will remain as zeros in the synthetic data, by
    leaving their prior as zeros. Each element of the <code>structzero</code> list is
    a list that describes a set of cells in the table defined by a combination
    of two or more variables and a name of each such element must consist of
    those variable names seperated by an underscore, e.g. <code>sex_edu</code>.
    The length of each such element is determined by the number of variables and
    each component gives the variable levels (numeric or labels) that define the
    structural zero cells (see an example below).</p></dd>

  <dt>gmargins</dt>
<dd><p>a single character to define a group of margins. At present
    there is "oneway" and "twoway" option that creates, respectively, all 1-way
    and 2-way margins from the table.</p></dd>

  <dt>othmargins</dt>
<dd><p>a list of margins that will be fitted. If <code>gmargins</code> is
    not <code>NULL</code> <code>othmargins</code> will be added to them.</p></dd>

  <dt>tol</dt>
<dd><p>stopping criterion for <code>Ipfp</code>.</p></dd>

  <dt>max.its</dt>
<dd><p>maximum umber of iterations allowed for <code>Ipfp</code>.</p></dd>

  <dt>maxtable</dt>
<dd><p>the number of cells in the cross-tabulation of all the
    variables that will trigger a severe warning.</p></dd>

  <dt>print.its</dt>
<dd><p>if true the iterations from <code>Ipfp</code> will be
    printed on the console. Otherwise only a message as to whether the
    iterations have converged will be given at the end of the fitting.</p></dd>

  <dt>epsilon</dt>
<dd><p>epsilon value for overall differential privacy (DP) parameter.
    This is implemented by dividing the privacy budget equally over all the
    margins used to fit the data.</p></dd>

  <dt>rand</dt>
<dd><p>when epsilon is &gt; 0 and DP synthetic data are created this
    determines whether the data are created by Poisson counts from the expected
    fitted counts in the cells of the DP adjusted data.</p></dd>

  <dt>...</dt>
<dd><p>additional parameters.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>When used in <code>syn</code> function the group of variables with
<code>method = "ipf"</code> must all be together at the start of the visit sequence.
This function is designed for categorical variables, but it can also be used for
numerical variables if they are categorised by specifying them in the
<code>numtocat</code> parameter of the main function <code>syn</code>. Subsequent variables
in <code>visit.sequence</code> are then synthesised conditional on the synthesised
values of the grouped variables. A fit to the table is obtained from the
log-linear fit that matches the numbers in the margins specified by the margin
parameters. Prior probabilities for the proportions in each cell of the table
are given by a Dirichlet distribution with the same parameter for every cell
in the table that is not a structural zero. The sum of these parameters is
<code>priorn</code>. The default <code>priorn = 1</code> can be thought of as equivalent
to the knowledge that <code>1</code> observation would be equally likely to
fall in any cell of the table. The synthetic data are generated from a multinomial
distribution with parameters given by the expected posterior probabilities for
each cell of the table. If the maximum likelihood estimate from the log-linear
fit to cell \(c_i\) is \(p_i\) and the table has \(N\) cells that are not
structural zeros then the expectation of the posterior probability
for this cell is \((p_i + priorn/N^2) / (1 + priorn / N^2)\) or
equivalently \((N * p_i + priorn/N) / (N + priorn / N)\).</p>
<p>Unlike <code>syn.satcat</code>, which fits saturated models from their conditional
distrinutions, <code>x</code> can include any combination of variables, including
those not present in the original data, except those defined by <code>structzero</code>.</p>
<p>NOTE that when the function is called by setting elements of
method in <code>syn</code> to <code>"ipf"</code>, the parameters <code>priorn</code>,
<code>structzero</code>, <code>gmargins</code>, <code>othmargins</code>, <code>tol</code>,
<code>max.its</code>, <code>maxtable</code>, <code>print.its</code>, <code>epsilon</code>,
and <code>rand</code> must be supplied to <code>syn</code> as e.g. <code>ipf.priorn</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list with two components:</p>
<dl><dt>res</dt>
<dd><p>a data frame with <code>k</code> rows containing the synthesised data.</p></dd>

  <dt>fit</dt>
<dd><p>a list made up of two lists: the margins fitted and the original
    data for each margin.</p></dd>

</dl></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">ods</span> <span class="op">&lt;-</span> <span class="va">SD2011</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">2</span>, <span class="fl">10</span>, <span class="fl">11</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">ods</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"placesize"</span>, <span class="st">"region"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         region</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> placesize                Dolnoslaskie Kujawsko-pomorskie Lodzkie Lubelskie</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   URBAN 500,000 AND OVER           60                  0      94         0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   URBAN 200,000-500,000            30                 15       0         0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   URBAN 100,000-200,000            64                 28      66        41</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   URBAN 20,000-100,000              0                 69       0        46</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   URBAN BELOW 20,000               57                 45      31        28</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   RURAL AREAS                     108                156     167       186</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         region</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> placesize                Lubuskie Malopolskie Mazowieckie Opolskie Podkarpackie</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   URBAN 500,000 AND OVER        0          64         126        0            0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   URBAN 200,000-500,000        33          10          10       19           17</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   URBAN 100,000-200,000        13          40          78       37           47</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   URBAN 20,000-100,000          0           0          23        0            0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   URBAN BELOW 20,000           42          37          72       24           37</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   RURAL AREAS                  65         220         261       73          212</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         region</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> placesize                Podlaskie Pomorskie Slaskie Swietokrzyskie</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   URBAN 500,000 AND OVER         0         0       0              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   URBAN 200,000-500,000          0         0     120              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   URBAN 100,000-200,000         31        64     121             38</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   URBAN 20,000-100,000          45        76      71             35</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   URBAN BELOW 20,000            25        35      28             30</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   RURAL AREAS                   92       131     160            127</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         region</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> placesize                Warminsko-mazurskie Wielkopolskie Zachodnio-pomorskie</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   URBAN 500,000 AND OVER                   0            48                   0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   URBAN 200,000-500,000                   42            10                  21</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   URBAN 100,000-200,000                   43            88                  44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   URBAN 20,000-100,000                     0             0                  42</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   URBAN BELOW 20,000                      45            53                  53</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   RURAL AREAS                            129           214                  88</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Each `placesize_region` sublist:</span></span></span>
<span class="r-in"><span><span class="co"># for each relevant level of `placesize` defined in the first element,</span></span></span>
<span class="r-in"><span><span class="co"># the second element defines regions (variable `region`) that do not</span></span></span>
<span class="r-in"><span><span class="co"># have places of that size.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">struct.zero</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  placesize_region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>placesize <span class="op">=</span> <span class="st">"URBAN 500,000 AND OVER"</span>,</span></span>
<span class="r-in"><span>                          region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">8</span><span class="op">:</span><span class="fl">13</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  placesize_region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>placesize <span class="op">=</span> <span class="st">"URBAN 200,000-500,000"</span>,</span></span>
<span class="r-in"><span>                          region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">10</span><span class="op">:</span><span class="fl">11</span>, <span class="fl">13</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  placesize_region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>placesize <span class="op">=</span> <span class="st">"URBAN 20,000-100,000"</span>,</span></span>
<span class="r-in"><span>                          region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">14</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">synipf</span> <span class="op">&lt;-</span> <span class="fu"><a href="syn.html">syn</a></span><span class="op">(</span><span class="va">ods</span>, method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"ipf"</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"ctree"</span>, <span class="st">"normrank"</span>, <span class="st">"ctree"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>              ipf.gmargins <span class="op">=</span> <span class="st">"twoway"</span>, ipf.othmargins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>              ipf.priorn <span class="op">=</span> <span class="fl">2</span>, ipf.structzero <span class="op">=</span> <span class="va">struct.zero</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Synthesis</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -----------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> First 4 variables (sex, placesize, region, edu) synthesised together by method 'ipf'</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in sampler.syn(p, data, m, syn, visit.sequence, rules, rvalues,     event, proper, print.flag, k, pred.not.syn, models, numtocat,     ...):</span> object 'struct.zero' not found</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Beata Nowok.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

